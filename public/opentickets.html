<!DOCTYPE html>
<html>
    <head>
        <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>  
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>  
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>  
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>
    
    <title>Open Tickets</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    </head>
    <body>
        <nav
      class="navbar navbar-expand-sm navbar-dark bg-dark"
      style="margin-top: 10px"
      aria-label="Third navbar example"
    >
      <div class="container-fluid">
        <a class="navbar-brand" href="dashboard.html" id="nav-dashboard">Dashboard</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarsExample03"
          aria-controls="navbarsExample03"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExample03">
          <ul class="navbar-nav me-auto mb-2 mb-sm-0">
            <li class="nav-item">
              <a
                class="nav-link active"
                href="newticket.html" id="nav-new-ticket"
                >New Ticket</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="opentickets.html" id="nav-view-ticket">View Open Tickets</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-closed-tickets">Closed Tickets</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="dropdown03"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                >Menu</a
              >
              <ul class="dropdown-menu" aria-labelledby="dropdown03">
                <li><a class="dropdown-item" href="#">Create New Ticket</a></li>
                <li><a class="dropdown-item" href="#">View Open Tickets</a></li>
                <li>
                  <a class="dropdown-item" href="#">View Closed Tickets</a>
                </li>
              </ul>
            </li>
          </ul>
          <form role="search">
            <input
              class="form-control"
              type="search"
              placeholder="Search Issue Database"
              aria-label="Search"
            />
          </form>
        </div>
      </div>


    </nav>
    <div class="container">
        <h1>Pending Tickets</h1>
        <div class="list-group">
            <button class="btn btn-warning dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        
            <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center list-group-item-warning">Currently Open Tickets<span class="badge bg-primary rounded-pill" id="open-pill">0</span></a></button>
            <ul class="dropdown-menu" id="open-tickets">
                <!-- <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Separated link</a></li> -->
              </ul>
            <h1></h1>
            <h1></h1>
          </div>
        <div class="list-group">
          <button class="btn btn-warning dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        
            <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center list-group-item-sucess">Currently Closed Tickets<span class="badge bg-primary rounded-pill" id="close-pill">0</span></a></button>
            <ul class="dropdown-menu" id="closed-tickets">
                <!-- <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><a class="dropdown-item" href="#">Something else here</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#">Separated link</a></li> -->
              </ul>
          </div>
        <!--  -->
        <script src="main.js"></script>
        <script>
      getData()
            async function getData(){
                const response = await fetch('/api')
                const data = await response.json()
                let numOpen = 0
                let numClose = 0
                const otickets = []
                const osorted = otickets.sort(function(a, b){return a-b})

                // Show number of open tickets on pill 
                for (item of data) {
                    // console.log(item.ticketStatus);
                    // console.log(numOpen)
                    const openTicket = document.getElementById('open-tickets')
                    const closedTicket = document.getElementById('closed-tickets')
                    const pillOpen = document.getElementById('open-pill');
                    const pillClose = document.getElementById('close-pill');
                    const inker = document.createElement('a');
                    inker.className = 'dropdown-item'
                    const listItem = document.createElement('li')
                    const newListItem = listItem.appendChild(inker)
                    osorted.forEach((x, i) => newListItem.textContent = `Ticket Id ${x}`)
                    if (item.ticketStatus === 'Open' && otickets.includes(item.ticketNumber) != true) {
                    
                        for (i in osorted){
                          console.log(i);
                          openTicket.appendChild(newListItem)
                          
                        }
                        numOpen ++;
                        pillOpen.textContent = numOpen;
                        otickets.push(Number(item.ticketNumber))
                        
                        // console.log(osorted);
                        

                    }if (item.ticketStatus === 'Closed') {
                        closedTicket.appendChild(newListItem)
                        newListItem.textContent = `Ticket Id ${item.ticketNumber}`
                        numClose ++;
                        pillClose.textContent = numClose;


                    }else {
                        console.log('No data');
                    }
                    
                        
                    // console.log(pillClose.textContent);
                    console.log(otickets);
                    console.log(typeof osorted[1]);
                  
                }

            }
      
  </script>
        <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
    </body>
</html>