<!DOCTYPE html>
<html>
  <head>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>

    <title>Open Tickets</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
  </head>
  <body>
    <nav
      class="navbar navbar-expand-sm navbar-dark bg-dark"
      style="margin-top: 10px"
      aria-label="Third navbar example"
    >
      <div class="container-fluid">
        <a class="navbar-brand" href="dashboard.html" id="nav-dashboard"
          >Dashboard</a
        >
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarsExample03"
          aria-controls="navbarsExample03"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsExample03">
          <ul class="navbar-nav me-auto mb-2 mb-sm-0">
            <li class="nav-item">
              <a
                class="nav-link active"
                href="newticket.html"
                id="nav-new-ticket"
                >New Ticket</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="opentickets.html" id="nav-view-ticket"
                >View Open Tickets</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" id="nav-closed-tickets">Closed Tickets</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="dropdown03"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                >Menu</a
              >
              <ul class="dropdown-menu" aria-labelledby="dropdown03">
                <li><a class="dropdown-item" href="#">Create New Ticket</a></li>
                <li><a class="dropdown-item" href="#">View Open Tickets</a></li>
                <li>
                  <a class="dropdown-item" href="#">View Closed Tickets</a>
                </li>
              </ul>
            </li>
          </ul>
          <form role="search">
            <input
              class="form-control"
              type="search"
              placeholder="Search Issue Database"
              aria-label="Search"
            />
          </form>
        </div>
      </div>
    </nav>
    <div class="container">
      <h1>Pending Tickets</h1>
      </div>
      <div class="container text-center"><div class="row">
        <div class="col">
          <button
        type="button"
        class="btn btn-outline-info position-relative dropdown-toggle btn-lg"
        type="button"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        Currently Open Tickets
        <span
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
          id="open-pill"
        >
          0
        </span>
        <ul class="dropdown-menu" id="open-tickets">
          <!-- <li><a class="dropdown-item" href="#" id="first-open-ticket">A1</a></li> -->
        </ul>
      </button>
        </div>
        <div class="col">
          <button
        type="button"
        class="btn btn-outline-success position-relative dropdown-toggle btn-lg"
        type="button"
        data-bs-toggle="dropdown"
        aria-expanded="false"
      >
        Currently Closed Tickets
        <span
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
          id="close-pill"
        >
          0
        </span>
        <ul class="dropdown-menu" id="closed-tickets">
          <!-- <li><a class="dropdown-item" href="#" id="first-close-ticket">A2</a></li> -->
        </ul>
      </button>
        </div>
      </div>
      <div class="row">
        <div class="col">
          
        </div>
        <div class="col">
          
        </div>
        
      </div></div>
      

      <h1></h1>
      <h1></h1>
    </div>
    
    <!--  -->
    <script src="main.js"></script>
    <script>
      getData();
      async function getData() {
        const response = await fetch("/api");
        const data = await response.json();
        let numOpen = 0;
        let numClose = 0;
        const otickets = [];
        // otickets.sort((a, b) => a - b);
        const ctickets = [];
        ctickets.sort((a, b) => a - b);
        

        // Show number of open tickets on pill

        for (item of data) {
          
          const firstOpenTicket = document.getElementById('first-open-ticket')
          const firstCloseTicket = document.getElementById('first-close-ticket')
          const openTicket = document.getElementById("open-tickets");
          const closedTicket = document.getElementById("closed-tickets");
          const pillOpen = document.getElementById("open-pill");
          const pillClose = document.getElementById("close-pill");
          const inker = document.createElement("a");
          inker.className = "dropdown-item";
          const listItem = document.createElement("li");
          const newListItem = listItem.appendChild(inker);
          function insertIds(arr) {
            arr.forEach(function (item, index) {
              newListItem.innerHTML = `Ticket Id ${item}`
              
            }) 
          }

          //For displaying dropdown of Currently open tickets
          if (
            item.ticketStatus === "Open" &&
            otickets.includes(item.ticketNumber) != true
          ) {
            
            numOpen++;
            pillOpen.textContent = numOpen;
            otickets.push(Number(item.ticketNumber));
            otickets.forEach(function (item, index) {
              openTicket.appendChild(newListItem);
            
            })
            insertIds(otickets)
            console.log(otickets);

          //For displaying dropdown of Currently closed tickets
          } else if (
            item.ticketStatus === "Closed" &&
            ctickets.includes(item.ticketNumber) != true
          ) {

            numClose++;
            pillClose.textContent = numClose;
            ctickets.push(Number(item.ticketNumber))
            ctickets.forEach(function (item, index) {
              closedTicket.appendChild(newListItem);
            })
            insertIds(ctickets)
             
          } else {
            console.log("No data");
          }
          
        }
      }
    </script>
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
  </body>
</html>
